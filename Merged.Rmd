---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 



```{r}
library(caret)
```

```{r}
train <- read.csv(file = 'train.csv')
test <- read.csv(file = 'test.csv')
```

```{r}
#We downloaded the data splitted as train and test data. We thought that we should bind this two datasets for our first data discovery to see how the data we got looks like and to get
#a better understanding of the variables.
data <- rbind(train, test)

```

```{r}
head(data)
```

```{r}
str(data)
```


```{r}
summary(data)
```


```{r}
#After summarizing the data we see that we have 393 missing values in 'Arrival.Delay.in.Minutes' so we decided to eliminate the rows containing this missing values in both train and test (da sie nur einen sehr kleinen teil des datensatzes ausmachen).
train <- na.omit(train)
test <- na.omit(test)
```


```{r}
#To simplify the levels of satisfaction we decided to rename them from 'neutral or dissatisfied' to 'no' and 'satisfied' to 'yes'. Since we cannot detect whether a customer was neutral or not satisfied we will not miss any important information.
test$satisfaction <-factor(test$satisfaction, levels = c("neutral or dissatisfied", "satisfied"), labels=c("no", "yes"))
train$satisfaction <- factor(train$satisfaction, levels = c("neutral or dissatisfied", "satisfied"), labels=c("no", "yes"))

```

```{r}
head(train)
```


```{r}
plot(data$satisfaction ~ data$Flight.Distance)
```

```{r}
plot(data$satisfaction ~ data$Baggage.handling)
```


```{r}
plot(data$satisfaction ~ data$Inflight.service)
```


```{r}
plot(data$satisfaction ~ data$Inflight.entertainment)
```


```{r}
plot(data$satisfaction ~ data$Food.and.drink)
```


```{r}
plot(data$satisfaction ~ data$Type.of.Travel)
```


```{r}
plot(data$satisfaction ~ data$On.board.service)

```


```{r}
plot(data$satisfaction ~ data$Seat.comfort)

```


```{r}
plot(data$satisfaction ~ data$Cleanliness)
```

```{r}
boxplot(data$Flight.Distance)
```


```{r}
# 1= On board service
# 2= Seat comfort
# 3= Cleanliness
# 4= Inflight Service
# 5= Inflight Entertainment
# 6= Food and Drink
# 7= Baggage handling
boxplot(data$On.board.service, data$Seat.comfort, data$Cleanliness, data$Inflight.service, data$Inflight.entertainment, data$Food.and.drink, data$Baggage.handling)
```
```{r}
set.seed(4567)
```


```{r}
#Model Building Logistic Regression
glm_model <- train(satisfaction~. -X -id, data = train, method = "glmnet", trControl = trainControl(method="cv",number=10), preProcess= c("center", "scale"))
```

```{r}
#plot logistic regression
plot(glm_model)
```


```{r}
#Predict Function Logistic Regression
predicted_logistic <- predict(glm_model, test)
```


```{r}
#Table Logistic Regression
table_glm <- table(predicted_logistic, test$satisfaction)
table_glm
```


```{r}
#Model Building Tree
tree <- train(
          satisfaction~. -X -id,
          train,
          method = "rpart",
          trControl = trainControl(
          method = "cv",
          number = 10,
        )
)
```


```{r}
#Plot Decision Tree
plot(tree)
```

```{r}
#Predict Funtion Decision tree
predicted_tree <- predict(tree, test)
```


```{r}
#Table Decision Tree
table_tree <- table(predicted_tree, test$satisfaction)
table_tree
```

```{r}
#KNN 
tcon <- trainControl(method = 'cv', number = 10, verboseIter = TRUE)
knn_model <- train(satisfaction~. -X -id,
                   train,
                   method = 'knn',
                   trControl = tcon
                   )
```

```{r}
summary(knn_model)
```


```{r}
predicted_knn <- predict(knn_model, test)
predicted_knn
```

```{r}
table_knn <- table(predicted_knn, test$satisfaction)
table_knn
```


```{r}
nnet = train(satisfaction~., data = train, method = "nnet", trControl = trainControl(method="cv",number=10))
```

```{r}
nnet
```


```{r}
summary(nnet)
```


```{r}
pred_nnet <- predict(nnet, test)
pred_nnet
```


```{r}
table_nnet <- table(pred_nnet, test$satisfaction)
table_nnet
```

```{r}
svm_tr_control = trainControl(method = "repeatedcv", number = 10,verboseIter = TRUE)
fit_model.svm <- train(satisfaction ~ . -X -id, train[1:5000, ], method = "svmLinear", trControl = svm_tr_control, na.action = na.pass, metric = 'Accuracy')
```

```{r}
fit_model.svm
```

```{r}
summary(model.svm)
```


```{r}
pred.svm <- predict(model.svm, test)
```


```{r}
tab.svm <- table(pred.svm, test$satisfaction)
tab.svm
```

```{r}
acc <- c(acc.svm = sum(diag(tab.svm))/sum(tab.svm)) ## accuracy
        
acc
```


```{r}
rec <- c(rec.svm = tab.svm[2,2]/(tab.svm[1,2] + tab.svm[2,2]))
        
rec
```


```{r}
prec <- c(prec.svm = tab.svm[2,2]/(tab.svm[2,1] + tab.svm[2,2]))

prec 
```

```{r}

model.nb <- train(
                satisfaction ~. -X -id,
                train,
                method = "naive_bayes",
                trControl = trainControl(
                    method = "cv",
                    number = 10,
                  )
              )

```


```{r}
summary(model.nb)
```


```{r}
pred.nb <- predict(model.nb, test, 
                type = "raw")
pred.nb

```

```{r}
table.nb <- table(pred.nb, test$satisfaction)
table.nb
confusionMatrix(table.nb)
```

```{r}
model_forest <- train(
            satisfaction~. -X -id,
            data = train,
            method = 'ranger',
            trControl = tcon
)
```

```{r}

```

acc <- c(acc.svm = sum(diag(tab.svm))/sum(tab.svm))
        
rec <- c(rec.svm = tab.svm[2,2]/(tab.svm[1,2] + tab.svm[2,2]))
        
prec <- c(prec.svm = tab.svm[2,2]/(tab.svm[2,1] + tab.svm[2,2]))

```{r}
list_of_tables <- list(table_knn, table_nnet, tab.svm, table_glm, table_tree, table.nb)
list_of_pred <- list(predicted_knn, pred_nnet, pred.svm, predicted_logistic, predicted_tree, pred.nb)
factor_satisfaction <- factor(test$satisfaction)



modelNames <- function() {
    for (j in list_of_tables) {
       confusionMatrixModels <- confusionMatrix(j)
      print(confusionMatrixModels, digits = 8)
    }
}

modelNames()
```

```{r}
naive_bayes_importance <- varImp(model.nb)
plot(naive_bayes_importance)
```

```{r}
fit_model.nb2 <- train(
                satisfaction ~. -X -id -Gender - Departure.Arrival.time.convenient - Departure.Delay.in.Minutes - Arrival.Delay.in.Minutes,
                train,
                method = "naive_bayes",
                metric = 'Accuracy',
                trControl = trainControl(
                    method = "cv",
                    number = 10,
                  )
              )
```


```{r}
fit_model.nb2
```


```{r}
confusionMatrix(table.nb)
```

```{r}
predicted_model_nb2 <- predict(model.nb2, test)
```


```{r}
table_model_nb2 <- table(predicted_model_nb2, test$satisfaction)
```

```{r}
#      Sensitivity : 0.8263                 
   #          Specificity : 0.9270                 
   #       Pos Pred Value : 0.9353                 
   #       Neg Pred Value : 0.8067                 
   #           Prevalence : 0.5611                 
   #       Detection Rate : 0.4636                 
   # Detection Prevalence : 0.4957                 
   #    Balanced Accuracy : 0.8766  
# 
# pred.nb                   neutral or dissatisfied satisfied
#   neutral or dissatisfied                   12004       830
#   satisfied                                  2524     10535


confusionMatrix(table_model_nb2)
```


```{r}
results <- resamples(list(
  svm = fit_model.svm,
  nb = fit_model.nb2
))
```

```{r}
ls()
```

```{r}
print(results)
```


```{r}
confusionMatrix(table_nnet)
```


